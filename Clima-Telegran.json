{
  "name": "Clima-Telegran",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=Gere um conteudo para linkedin usando esse conteudo.\n\n\nTema principal: {{ $json.message.text }}",
        "options": {
          "systemMessage": "=Descri√ß√£o:\nVoc√™ √© um assistente virtual de clima integrado a um chatbot no Telegram. Sua fun√ß√£o √© informar a temperatura atual e as condi√ß√µes clim√°ticas de cidades do Brasil de forma clara, objetiva e amig√°vel.\n\nTema principal:\nConsulta de temperatura e condi√ß√µes clim√°ticas atuais (somente do dia corrente) para cidades brasileiras.\n\nObjetivo:\n\n* Identificar o nome da cidade mencionada pelo usu√°rio.\n* Considerar que a cidade pertence ao Brasil, mesmo que o estado n√£o seja informado.\n* Entender varia√ß√µes de linguagem natural como:\n\n  * \"Qual o clima no Rio?\"\n  * \"Como est√° o tempo em Recife?\"\n  * \"Temperatura em S√£o Paulo\"\n* Fornecer apenas informa√ß√µes do dia atual.\n* N√£o gerar conte√∫dos fora do contexto de clima.\n* N√£o fornecer previs√µes futuras ou hist√≥ricas.\n\nUSO OBRIGAT√ìRIO DE FERRAMENTA:\n\n* √â obrigat√≥rio consultar a ferramenta Tavily Search antes de gerar qualquer resposta v√°lida de clima.\n* Sempre pesquisar usando o formato:\n  \"clima atual em {cidade} Brasil\"\n* Nunca inventar valores.\n* Nunca responder com base em conhecimento pr√≥prio ou mem√≥ria.\n* Se n√£o for poss√≠vel obter dados confi√°veis, retornar resposta de erro.\n\nValida√ß√µes obrigat√≥rias:\n\n1. Pergunta fora de contexto\n   Se a mensagem n√£o estiver relacionada a clima, temperatura ou tempo.\n\n2. Cidade n√£o informada\n   Se o usu√°rio perguntar sobre clima sem mencionar uma cidade.\n\n3. Data diferente do dia atual\n   Se o usu√°rio solicitar clima de:\n\n* outro dia\n* semana passada ou futura\n* m√™s ou ano espec√≠fico\n  Responder informando que apenas o dia atual est√° dispon√≠vel.\n\n4. Pa√≠s diferente do Brasil\n   Se a cidade solicitada n√£o estiver no Brasil.\n\n5. Falha na busca ou dados indispon√≠veis\n\nRegras de Emojis (clima):\n\n* C√©u limpo / ensolarado ‚Üí ‚òÄÔ∏è\n* Parcialmente nublado ‚Üí üå§Ô∏è\n* Nublado / encoberto ‚Üí ‚òÅÔ∏è\n* Chuva / pancadas / garoa ‚Üí üåßÔ∏è\n* Tempestade ‚Üí ‚õàÔ∏è\n* N√©voa / neblina ‚Üí üå´Ô∏è\n* Frio intenso ‚Üí ‚ùÑÔ∏è\n* Vento forte ‚Üí üí®\n\nRegras adicionais:\n\n* Sempre incluir üå°Ô∏è para temperatura.\n* O emoji de clima deve aparecer antes da descri√ß√£o da condi√ß√£o.\n* Escolher o emoji mais adequado com base na condi√ß√£o retornada.\n\nFormato da resposta de sucesso:\n\nüìç Cidade: {cidade}\nüå°Ô∏è Temperatura: {temperatura}¬∞C\n{emoji_clima} Condi√ß√£o: {descricao_do_clima}\n\nFormato de sa√≠da obrigat√≥rio:\n\n* Responder APENAS em JSON v√°lido.\n* N√£o usar markdown.\n* N√£o incluir texto fora do JSON.\n* N√£o adicionar explica√ß√µes extras.\n\nEstrutura obrigat√≥ria:\n\n{\n\"cidade\": \"Nome da cidade ou null\",\n\"temperatura\": numero_em_celsius_ou_null,\n\"condicao\": \"Descri√ß√£o do clima ou null\",\n\"resposta\": \"Mensagem formatada para o Telegram\"\n}\n\nRespostas de erro (sempre iniciar com üò¢):\n\nPergunta fora de contexto:\n{\n\"cidade\": null,\n\"temperatura\": null,\n\"condicao\": null,\n\"resposta\": \"üò¢ Este assistente √© exclusivo para consultas de clima atual em cidades do Brasil.\"\n}\n\nCidade n√£o informada:\n{\n\"cidade\": null,\n\"temperatura\": null,\n\"condicao\": null,\n\"resposta\": \"üò¢ Por favor, informe o nome de uma cidade do Brasil para consultar o clima atual.\"\n}\n\nData diferente do dia atual:\n{\n\"cidade\": null,\n\"temperatura\": null,\n\"condicao\": null,\n\"resposta\": \"üò¢ S√≥ √© poss√≠vel consultar o clima do dia atual. Informe uma cidade brasileira para continuar.\"\n}\n\nPa√≠s diferente do Brasil:\n{\n\"cidade\": null,\n\"temperatura\": null,\n\"condicao\": null,\n\"resposta\": \"üò¢ Este servi√ßo est√° dispon√≠vel apenas para cidades do Brasil.\"\n}\n\nFalha na consulta ou dados indispon√≠veis:\n{\n\"cidade\": null,\n\"temperatura\": null,\n\"condicao\": null,\n\"resposta\": \"üò¢ N√£o foi poss√≠vel obter os dados do clima no momento. Por favor, tente novamente.\"\n}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        640,
        400
      ],
      "id": "15f02eda-1c43-42ed-b64f-4fd991aaafed",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-5-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        576,
        624
      ],
      "id": "e6360738-cd78-4884-bac4-26c59e896297",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "Wen8BlswFVQWda4k",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Use this tood to search the web. Require `query` param",
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `The search query`, 'string') }}"
            },
            {
              "name": "search_depth",
              "value": "advanced"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        832,
        624
      ],
      "id": "483a70ca-9c10-4bbd-befd-445d6d973a31",
      "name": "Tavily Search",
      "credentials": {
        "httpHeaderAuth": {
          "id": "YLdCqaNi9SvKt5ye",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ce6cbea9-1619-42c1-9289-2f41e74fda51",
              "name": "post",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1040,
        400
      ],
      "id": "06321601-4a74-4345-af45-59394a99ebf9",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        352,
        400
      ],
      "id": "7bf5de2c-e69e-41fd-8910-9ddbd8e2fa77",
      "name": "Telegram Trigger1",
      "webhookId": "37dfb0ca-bd4a-4a0a-b749-99dc8d0cff0f",
      "credentials": {
        "telegramApi": {
          "id": "pGLz5XtMw1wKXfkM",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "GWIzWC3mYDz8kX68",
          "mode": "list",
          "cachedResultName": "clima",
          "cachedResultUrl": "/projects/NTzbQfB4WxYlVSFs/datatables/GWIzWC3mYDz8kX68"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "cidade": "={{ JSON.parse($json.post).cidade }}",
            "temperatura": "={{ JSON.parse($json.post).temperatura }}",
            "condicoes": "={{ JSON.parse($json.post).condicao }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "cidade",
              "displayName": "cidade",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "temperatura",
              "displayName": "temperatura",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "condicoes",
              "displayName": "condicoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        1264,
        304
      ],
      "id": "3aa53b4d-a490-450f-8186-d63394aa88ff",
      "name": "Insert row"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ol√°, segue a temperatura solicitada.\n\n{{ JSON.parse($json.post).resposta }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1264,
        496
      ],
      "id": "3469e573-84e8-41db-a2f3-68e992581761",
      "name": "Send a text message",
      "webhookId": "218b8635-2fd1-4922-80df-b104871d924a",
      "credentials": {
        "telegramApi": {
          "id": "pGLz5XtMw1wKXfkM",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {
    "Telegram Trigger1": [
      {
        "json": {
          "update_id": 663424310,
          "message": {
            "message_id": 7,
            "from": {
              "id": 8461623748,
              "is_bot": false,
              "first_name": "Ednei",
              "last_name": "Freitas",
              "language_code": "pt-br"
            },
            "chat": {
              "id": 8461623748,
              "first_name": "Ednei",
              "last_name": "Freitas",
              "type": "private"
            },
            "date": 1771732963,
            "text": "Qual o clima da cidade de Nova York"
          }
        }
      }
    ]
  },
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Tavily Search": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "77601c2e-f1ac-4ca4-8457-1e3e4d15fb8f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "79662fafd4c4840cc39132e717209a49dbeaf438f162e61a6c6189cb1eef43d9"
  },
  "id": "QKRcRMozR9h7j5f0",
  "tags": []
}